# Branch protection policy

Основная ветка `main` защищена и предназначена только для проверенных релизов.
Любые изменения попадают в неё исключительно через pull request.

## Обязательные проверки

Перед merge должны успешно пройти все требуемые джобы GitHub Actions:

| Статус | Назначение |
| --- | --- |
| `lint` | `ruff`, `black --check` и `mypy` гарантируют чистый стиль и типы. |
| `test` | Полный `pytest` прогон + smoke golden replay. |
| `golden-master` | Режим воспроизведения golden-сценариев без дрейфа. |
| `self-check` | Операционный self-check с валидацией профиля и ENV. |
| `security-sweep` | `bandit` и `pip-audit` для статической и dependency-безопасности. |
| `acceptance` | E2E acceptance-smoke/trading (и chaos при включении). |
| `Docker Release / build` | Мультиархитектурная сборка Docker образа. |

Если какая-либо проверка падает, PR запрещено объединять до устранения проблем.

## Workflow

1. Создавайте рабочие ветки от `main`.
2. Локально запускайте `make verify`, чтобы воспроизвести CI-пайплайн до push.
3. Создавайте PR в `main`; прямые push запрещены настройками репозитория.
4. Для всех нетривиальных изменений требуется минимум один review от независимого
   участника команды. См. CODEOWNERS для автоматического назначения.
5. После approve и зелёных проверок merge выполняется кнопкой «Merge pull request»
   с сохранением истории (`squash` допустим только после согласования с командой).

Политика защищает от случайного обхода проверок и гарантирует, что каждый релиз
проходит весь набор lint/test/security/docker процедур перед попаданием в `main`.

